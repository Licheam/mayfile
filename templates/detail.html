<!doctype html>
<html lang="{{ strings.lang }}">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ item.title }}</title>
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/github.min.css" />
</head>

<body>
  <main class="container">

    <div class="title-row">
      <h1>{{ item.title }}</h1>
      <a class="btn btn-secondary" href="/">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path
            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z" />
        </svg>
        {{ strings.detail_new_paste }}
      </a>
    </div>
    <div class="meta-info">
      <div class="meta-item" title="{{ strings.detail_expires_label }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>{{ expires_in }}</span>
      </div>

      <div class="meta-item" title="{{ strings.label_language }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="16 18 22 12 16 6"></polyline>
          <polyline points="8 6 2 12 8 18"></polyline>
        </svg>
        <span id="language-label-val">{{ language_label }}</span>
      </div>

      {% if remaining_views.is_some() %}
      <div class="meta-item" title="{{ strings.label_burn }}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <span>{{ remaining_views.as_ref().unwrap() }}</span>
      </div>
      {% endif %}
    </div>
    <div class="detail-actions">
      <button class="btn btn-secondary" type="button" id="copy-btn" data-label="{{ strings.detail_copy }}"
        data-copied="{{ strings.detail_copy_done }}">
        {{ strings.detail_copy }}
      </button>
      <a class="btn btn-secondary" href="/r/{{ token }}">{{ strings.detail_raw }}</a>
    </div>
    <div class="code-wrapper">
      <div class="line-numbers" id="line-numbers"></div>
      <pre
        class="paste-content"><code id="paste-content" data-language="{{ item.language }}">{{ item.content }}</code></pre>
    </div>

    <footer class="footer">
      <div class="language-selector">
        <a href="?lang=en" class="lang-link">English</a>
        <span class="separator">/</span>
        <a href="?lang=zh" class="lang-link">中文</a>
      </div>
    </footer>
  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script>
  <script>
    const copyButton = document.getElementById("copy-btn");
    const content = document.getElementById("paste-content");
    const lineNumbers = document.getElementById("line-numbers");

    if (content) {
      const source = content.textContent || "";
      if (lineNumbers) {
        const linesCount = source.split(/\r\n|\r|\n/).length;
        let nums = "";
        for (let i = 1; i <= linesCount; i++) {
          nums += i + "\n";
        }
        lineNumbers.textContent = nums;
      }

      const language = content.dataset.language || "auto";
      if (window.hljs) {
        if (language === "auto") {
          const result = window.hljs.highlightAuto(source);
          content.innerHTML = result.value;
          content.classList.add("hljs");
          if (result.language) {
            const langLabel = document.getElementById("language-label-val");
            if (langLabel) {
              langLabel.textContent += " (" + result.language + ")";
            }
          }
        } else if (window.hljs.getLanguage(language)) {
          const result = window.hljs.highlight(source, { language });
          content.innerHTML = result.value;
          content.classList.add("hljs");
        } else {
          const result = window.hljs.highlightAuto(source);
          content.innerHTML = result.value;
          content.classList.add("hljs");
        }
      }
    }

    if (copyButton && content) {
      copyButton.addEventListener("click", async () => {
        const text = content.textContent || "";
        try {
          await navigator.clipboard.writeText(text);
          copyButton.textContent = copyButton.dataset.copied || copyButton.textContent;
          setTimeout(() => {
            copyButton.textContent = copyButton.dataset.label || copyButton.textContent;
          }, 1500);
        } catch {
          copyButton.textContent = copyButton.dataset.label || copyButton.textContent;
        }
      });
    }
  </script>
</body>

</html>